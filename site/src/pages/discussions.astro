---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Discussions - Kylo Parisher Portfolio" description="GitHub Discussions">
  <div class="mb-8">
    <h1 class="text-3xl font-bold mb-2">ðŸ’¬ Discussions</h1>
    <p class="text-base-content/70">
      Latest discussions from the repository.
    </p>
  </div>

  <div id="discussions-container" class="space-y-4">
    <div class="flex justify-center py-12">
      <span class="loading loading-spinner loading-lg"></span>
    </div>
  </div>

  <script>
    interface Discussion {
      number: number;
      title: string;
      url: string;
      author: string;
      createdAt: string;
      comments: number;
      category: string;
    }

    async function loadDiscussions() {
      try {
        const response = await fetch('/data/discussions.json');
        if (!response.ok) {
          throw new Error('Failed to load discussions');
        }
        const discussions: Discussion[] = await response.json();
        
        const container = document.getElementById('discussions-container')!;
        
        if (discussions.length === 0) {
          container.innerHTML = `
            <div class="alert alert-info">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              <span>No discussions found yet. Start a conversation on GitHub!</span>
            </div>
          `;
          return;
        }

        container.innerHTML = discussions.map(discussion => `
          <div class="card bg-base-200 shadow-xl">
            <div class="card-body">
              <div class="flex items-start justify-between">
                <div class="flex-1">
                  <h2 class="card-title">
                    <a href="${discussion.url}" target="_blank" rel="noopener noreferrer" class="link link-primary">
                      ${discussion.title}
                    </a>
                  </h2>
                  <p class="text-sm text-base-content/70 mt-2">
                    <span class="badge badge-sm badge-outline">${discussion.category}</span>
                    by ${discussion.author} â€¢ ${new Date(discussion.createdAt).toLocaleDateString()} â€¢ ${discussion.comments} comments
                  </p>
                </div>
                <a href="${discussion.url}" target="_blank" rel="noopener noreferrer" class="btn btn-sm btn-outline">
                  View â†’
                </a>
              </div>
            </div>
          </div>
        `).join('');
      } catch (error) {
        console.error('Error loading discussions:', error);
        document.getElementById('discussions-container')!.innerHTML = `
          <div class="alert alert-warning">
            <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
            </svg>
            <span>Discussions data not available. This data is generated during CI/CD deployment.</span>
          </div>
        `;
      }
    }

    loadDiscussions();
  </script>
</Layout>
